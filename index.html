<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¯ãƒªãƒƒã‚«ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      text-align: center;
      background: #000000;
      color: #e0e0e0;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    .container {
      max-width: 700px;
      margin: 20px auto;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }
    h2 {
      color: #00f7ff;
      text-shadow: 0 0 5px rgba(0, 247, 255, 0.5);
      font-size: clamp(20px, 3vw, 24px);
    }
    p, span {
      color: #e0e0e0;
      word-break: break-word;
      overflow-wrap: break-word;
      font-size: clamp(14px, 2vw, 16px);
      max-width: 100%;
    }
    button {
      padding: 12px 24px;
      margin: 8px;
      font-size: clamp(14px, 2vw, 16px);
      cursor: pointer;
      border: none;
      border-radius: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
      display: inline-block;
      max-width: 200px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
    }
    button:active {
      transform: scale(0.95);
    }
    #clickButton {
      font-size: 24px;
      padding: 20px;
      background: #ff00ff;
      color: #ffffff;
      border-radius: 50%;
      width: 100px;
      height: 100px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .point-pop {
      position: absolute;
      color: #f4ff00;
      font-size: 20px;
      font-weight: bold;
      animation: floatUp 1s ease-out forwards;
      pointer-events: none;
      z-index: 1000;
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-50px); }
    }
    #loginScreen, #gameScreen, #upgradesScreen, #settingsScreen, #itemsScreen, #pvpScreen, #searchScreen {
      display: none;
    }
    #loginScreen.active, #gameScreen.active, #upgradesScreen.active, #settingsScreen.active, #itemsScreen.active, #pvpScreen.active, #searchScreen.active {
      display: block;
    }
    .tab-bar {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      visibility: visible;
      z-index: 10;
    }
    .tab-button {
      background: #00f7ff;
      color: #000000;
    }
    .upgrade-section, .item-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-top: 20px;
    }
    .upgrade-button, .item-button {
      background: #39ff14;
      color: #000000;
      max-width: 150px;
    }
    .upgrade-button.disabled, .item-button.disabled {
      background: #4a4a4a;
      color: #b0b0b0;
      cursor: not-allowed;
    }
    .item-button::after, .upgrade-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s, height 0.4s;
    }
    .item-button:hover::after, .upgrade-button:hover::after {
      width: 200px;
      height: 200px;
    }
    input, select {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
      border: 2px solid #ff00ff;
      font-size: clamp(14px, 2vw, 16px);
      background: #1a1a1a;
      color: #ffffff;
      max-width: 300px;
      word-break: break-word;
    }
    .profile-section, .pvp-section, .search-section {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ­ã‚°ã‚¤ãƒ³/ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆç”»é¢ -->
    <div id="loginScreen" class="active">
      <h2>ã‚¯ãƒªãƒƒã‚«ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
      <input type="text" id="usernameInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
      <select id="iconSelect">
        <option value="ğŸ˜º">ğŸ˜º çŒ«</option>
        <option value="ğŸ¶">ğŸ¶ çŠ¬</option>
        <option value="ğŸ¦">ğŸ¦ ãƒ©ã‚¤ã‚ªãƒ³</option>
        <option value="ğŸ¦„">ğŸ¦„ ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³</option>
      </select>
      <button onclick="createAccount()">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</button>
      <button onclick="login()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen">
      <h2>ã‚¯ãƒªãƒƒã‚«ãƒ¼ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼: <span id="displayUsername"></span> (<span id="displayIcon"></span>)</p>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="userId"></span></p>
      <p>ãƒã‚¤ãƒ³ãƒˆ: <span id="points">0</span></p>
      <p>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŠ¹æœ: <span id="activeEffects">ãªã—</span></p>
      <button id="clickButton" onclick="clickPoint()">ã‚¯ãƒªãƒƒã‚¯ï¼</button>
      <div class="tab-bar">
        <button class="tab-button" onclick="showUpgrades()">ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</button>
        <button class="tab-button" onclick="showItems()">ã‚¢ã‚¤ãƒ†ãƒ </button>
        <button class="tab-button" onclick="showPvp()">PvP</button>
        <button class="tab-button" onclick="showSearch()">æ¤œç´¢</button>
        <button class="tab-button" onclick="showSettings()">è¨­å®š</button>
      </div>
    </div>

    <!-- ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”»é¢ -->
    <div id="upgradesScreen">
      <h2>ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h2>
      <p>ãƒã‚¤ãƒ³ãƒˆ: <span id="upgradePoints">0</span></p>
      <div class="upgrade-section">
        <button class="upgrade-button" onclick="buyUpgrade(0)">ã‚¯ãƒªãƒƒã‚¯å¼·åŒ–<br>ã‚³ã‚¹ãƒˆ: <span id="upgradeCost0">10</span><br>ãƒ¬ãƒ™ãƒ«: <span id="upgradeLevel0">0</span></button>
        <button class="upgrade-button" onclick="buyUpgrade(1)">ã‚ªãƒ¼ãƒˆé€Ÿåº¦<br>ã‚³ã‚¹ãƒˆ: <span id="upgradeCost1">50</span><br>ãƒ¬ãƒ™ãƒ«: <span id="upgradeLevel1">0</span></button>
        <button class="upgrade-button" onclick="buyUpgrade(2)">ãƒã‚¤ãƒ³ãƒˆå€ç‡<br>ã‚³ã‚¹ãƒˆ: <span id="upgradeCost2">100</span><br>ãƒ¬ãƒ™ãƒ«: <span id="upgradeLevel2">0</span></button>
        <button class="upgrade-button" onclick="buyUpgrade(3)">ã‚ªãƒ¼ãƒˆåŠ¹ç‡<br>ã‚³ã‚¹ãƒˆ: <span id="upgradeCost3">200</span><br>ãƒ¬ãƒ™ãƒ«: <span id="upgradeLevel3">0</span></button>
        <button class="upgrade-button" onclick="buyUpgrade(4)">ãƒ©ãƒƒã‚­ãƒ¼ãƒœãƒ¼ãƒŠã‚¹<br>ã‚³ã‚¹ãƒˆ: <span id="upgradeCost4">500</span><br>ãƒ¬ãƒ™ãƒ«: <span id="upgradeLevel4">0</span></button>
      </div>
      <button class="tab-button" onclick="backToGame()">æˆ»ã‚‹</button>
    </div>

    <!-- ã‚¢ã‚¤ãƒ†ãƒ ç”»é¢ -->
    <div id="itemsScreen">
      <h2>ã‚¢ã‚¤ãƒ†ãƒ </h2>
      <p>ãƒã‚¤ãƒ³ãƒˆ: <span id="itemPoints">0</span></p>
      <div class="item-section">
        <button class="item-button" onclick="buyItem(0)">ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³<br>ã‚³ã‚¹ãƒˆ: 500<br>æ‰€æŒ: <span id="itemCount0">0</span></button>
        <button class="item-button" onclick="useItem(0)">ä½¿ç”¨</button>
        <button class="item-button" onclick="buyItem(1)">ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹<br>ã‚³ã‚¹ãƒˆ: 200<br>æ‰€æŒ: <span id="itemCount1">0</span></button>
        <button class="item-button" onclick="useItem(1)">ä½¿ç”¨</button>
      </div>
      <button class="tab-button" onclick="backToGame()">æˆ»ã‚‹</button>
    </div>

    <!-- PvPç”»é¢ -->
    <div id="pvpScreen">
      <h2>CPS PvP</h2>
      <p>ãƒã‚¤ãƒ³ãƒˆ: <span id="pvpPoints">0</span></p>
      <p>ãƒ©ãƒ³ã‚­ãƒ³ã‚°: <span id="rank">æœªå‚åŠ </span></p>
      <p>å¯¾æˆ¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span id="pvpStatus">å¾…æ©Ÿä¸­</span></p>
      <button class="tab-button" onclick="findOpponent()">å¯¾æˆ¦ç›¸æ‰‹ã‚’æ¢ã™</button>
      <button class="tab-button" onclick="readyForMatch()" disabled id="readyButton">æº–å‚™å®Œäº†</button>
      <button class="tab-button" onclick="startMatch()" disabled id="startButton">è©¦åˆé–‹å§‹</button>
      <button class="tab-button" onclick="backToGame()">æˆ»ã‚‹</button>
    </div>

    <!-- æ¤œç´¢ç”»é¢ -->
    <div id="searchScreen">
      <h2>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢</h2>
      <input type="text" id="searchInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¾ãŸã¯ID">
      <button class="tab-button" onclick="searchPlayer()">æ¤œç´¢</button>
      <div class="search-section">
        <p>çµæœ: <span id="searchResult">æœªæ¤œç´¢</span></p>
      </div>
      <button class="tab-button" onclick="backToGame()">æˆ»ã‚‹</button>
    </div>

    <!-- è¨­å®šç”»é¢ -->
    <div id="settingsScreen">
      <h2>è¨­å®š</h2>
      <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: <span id="settingsUserId"></span></p>
      <input type="text" id="newUsername" placeholder="æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
      <select id="newIcon">
        <option value="ğŸ˜º">ğŸ˜º çŒ«</option>
        <option value="ğŸ¶">ğŸ¶ çŠ¬</option>
        <option value="ğŸ¦">ğŸ¦ ãƒ©ã‚¤ã‚ªãƒ³</option>
        <option value="ğŸ¦„">ğŸ¦„ ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ³</option>
      </select>
      <button onclick="updateProfile()">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°</button>
      <button onclick="confirmReset()">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒªã‚»ãƒƒãƒˆ</button>
      <button onclick="confirmDelete()">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤</button>
      <button class="tab-button" onclick="backToGame()">æˆ»ã‚‹</button>
    </div>
  </div>

  <script>
    let points = 0;
    let user = null;
    let upgrades = [
      { level: 0, cost: 10, effect: 1 }, // ã‚¯ãƒªãƒƒã‚¯å¼·åŒ–
      { level: 0, cost: 50, effect: 0.1 }, // ã‚ªãƒ¼ãƒˆé€Ÿåº¦
      { level: 0, cost: 100, effect: 1.5 }, // ãƒã‚¤ãƒ³ãƒˆå€ç‡
      { level: 0, cost: 200, effect: 0.2 }, // ã‚ªãƒ¼ãƒˆåŠ¹ç‡
      { level: 0, cost: 500, effect: 0.05 } // ãƒ©ãƒƒã‚­ãƒ¼ãƒœãƒ¼ãƒŠã‚¹
    ];
    let items = [
      { name: 'ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³', count: 0, cost: 500 }, // 5åˆ†é–“ã‚¯ãƒªãƒƒã‚¯2å€
      { name: 'ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹', count: 0, cost: 200 } // 50ï½1000ãƒã‚¤ãƒ³ãƒˆ
    ];
    let autoInterval = null;
    let doubleClickActive = false;
    let doubleClickTimeout = null;
    let pvpRank = 0;
    let pvpStatus = 'å¾…æ©Ÿä¸­';
    let opponent = null;
    let playerReady = false;
    let opponentReady = false;
    let clickCount = 0;
    let matchStartTime = null;

    // UUIDç”Ÿæˆ
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰
    let mockDatabase = JSON.parse(localStorage.getItem('mockDatabase')) || [
      { id: generateUUID(), username: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1', icon: 'ğŸ˜º', points: 1000, rank: 1 },
      { id: generateUUID(), username: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2', icon: 'ğŸ¶', points: 800, rank: 2 },
      { id: generateUUID(), username: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1', icon: 'ğŸ¦', points: 600, rank: 3 }
    ];

    // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
    function switchScreen(showId) {
      const screens = ['loginScreen', 'gameScreen', 'upgradesScreen', 'settingsScreen', 'itemsScreen', 'pvpScreen', 'searchScreen'];
      screens.forEach(id => document.getElementById(id).classList.remove('active'));
      document.getElementById(showId).classList.add('active');
      console.log(`ç”»é¢åˆ‡ã‚Šæ›¿ãˆ: ${showId}`);
      updateUI();
    }

    // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
    function createAccount() {
      const username = document.getElementById('usernameInput').value;
      const icon = document.getElementById('iconSelect').value;
      if (username) {
        const userId = generateUUID();
        user = { id: userId, username, icon, points: 0, upgrades, items, rank: 0 };
        localStorage.setItem('clickerUser', JSON.stringify(user));
        mockDatabase.push({ id: userId, username, icon, points: 0, rank: 0 });
        localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
        console.log('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ:', user);
        loadGame();
      } else {
        alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
    }

    // ãƒ­ã‚°ã‚¤ãƒ³
    function login() {
      const savedUser = localStorage.getItem('clickerUser');
      if (savedUser) {
        user = JSON.parse(savedUser);
        console.log('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ:', user);
        loadGame();
      } else {
        alert('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ä½œæˆã—ã¦ãã ã•ã„ã€‚');
      }
    }

    // ã‚²ãƒ¼ãƒ ç”»é¢èª­ã¿è¾¼ã¿
    function loadGame() {
      switchScreen('gameScreen');
      points = user.points;
      upgrades = user.upgrades;
      items = user.items || items;
      pvpRank = user.rank || 0;
      console.log('ã‚²ãƒ¼ãƒ ç”»é¢èª­ã¿è¾¼ã¿:', { points, upgrades, items, pvpRank });
      updateUI();
      startAutoClick();
      checkMonthlyReset();
    }

    // UIæ›´æ–°
    function updateUI() {
      document.getElementById('points').textContent = Math.floor(points);
      document.getElementById('upgradePoints').textContent = Math.floor(points);
      document.getElementById('itemPoints').textContent = Math.floor(points);
      document.getElementById('pvpPoints').textContent = Math.floor(points);
      document.getElementById('displayUsername').textContent = user.username;
      document.getElementById('displayIcon').textContent = user.icon;
      document.getElementById('userId').textContent = user.id;
      document.getElementById('settingsUserId').textContent = user.id;
      document.getElementById('rank').textContent = pvpRank || 'æœªå‚åŠ ';
      document.getElementById('pvpStatus').textContent = pvpStatus;
      document.getElementById('activeEffects').textContent = doubleClickActive ? `ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³ (æ®‹ã‚Š${Math.floor((doubleClickTimeout - Date.now()) / 1000)}ç§’)` : 'ãªã—';
      upgrades.forEach((upgrade, i) => {
        document.getElementById(`upgradeCost${i}`).textContent = upgrade.cost;
        document.getElementById(`upgradeLevel${i}`).textContent = upgrade.level;
        const button = document.getElementsByClassName('upgrade-button')[i];
        button.disabled = points < upgrade.cost;
        button.classList.toggle('disabled', points < upgrade.cost);
      });
      items.forEach((item, i) => {
        document.getElementById(`itemCount${i}`).textContent = item.count;
        const buyButton = document.getElementsByClassName('item-button')[i * 2];
        const useButton = document.getElementsByClassName('item-button')[i * 2 + 1];
        buyButton.disabled = points < item.cost;
        buyButton.classList.toggle('disabled', points < item.cost);
        useButton.disabled = item.count <= 0;
        useButton.classList.toggle('disabled', item.count <= 0);
      });
      saveGame();
    }

    // ã‚¯ãƒªãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
    function clickPoint() {
      let pointGain = 1 + upgrades[0].level * upgrades[0].effect;
      pointGain *= (1 + upgrades[2].level * upgrades[2].effect);
      if (upgrades[4].level > 0 && Math.random() < upgrades[4].level * upgrades[4].effect) {
        pointGain *= 2;
      }
      if (doubleClickActive) pointGain *= 2;
      points += pointGain;
      clickCount++;
      showPointPop(pointGain);
      updateUI();
      console.log('ã‚¯ãƒªãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ:', pointGain);
    }

    // ãƒã‚¤ãƒ³ãƒˆãƒãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function showPointPop(amount) {
      const pop = document.createElement('div');
      pop.className = 'point-pop';
      pop.textContent = `+${Math.floor(amount)}`;
      pop.style.left = `${Math.random() * 100 + 300}px`;
      pop.style.top = '50%';
      document.body.appendChild(pop);
      setTimeout(() => pop.remove(), 1000);
    }

    // ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚ªãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰
    function startAutoClick() {
      if (autoInterval) {
        clearInterval(autoInterval);
        console.log('æ—¢å­˜ã®ã‚ªãƒ¼ãƒˆã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚’ã‚¯ãƒªã‚¢');
      }
      autoInterval = setInterval(() => {
        let pointGain = 0.1 + upgrades[1].level * upgrades[1].effect;
        pointGain *= (1 + upgrades[3].level * upgrades[3].effect);
        if (upgrades[4].level > 0 && Math.random() < upgrades[4].level * upgrades[4].effect) {
          pointGain *= 2;
        }
        points += pointGain;
        updateUI();
      }, 500);
      console.log('ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚ªãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰é–‹å§‹');
    }

    // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰è³¼å…¥
    function buyUpgrade(index) {
      if (points >= upgrades[index].cost) {
        points -= upgrades[index].cost;
        upgrades[index].level++;
        upgrades[index].cost = Math.round(upgrades[index].cost * 1.5);
        updateUI();
        console.log(`ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰${index}è³¼å…¥: ãƒ¬ãƒ™ãƒ«${upgrades[index].level}`);
      } else {
        alert('ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
      }
    }

    // ã‚¢ã‚¤ãƒ†ãƒ è³¼å…¥
    function buyItem(index) {
      if (points >= items[index].cost) {
        points -= items[index].cost;
        items[index].count++;
        updateUI();
        console.log(`ã‚¢ã‚¤ãƒ†ãƒ ${items[index].name}è³¼å…¥: æ‰€æŒ${items[index].count}`);
      } else {
        alert('ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
      }
    }

    // ã‚¢ã‚¤ãƒ†ãƒ ä½¿ç”¨
    function useItem(index) {
      if (items[index].count <= 0) {
        alert('ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ï¼');
        return;
      }
      items[index].count--;
      if (index === 0) { // ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³
        doubleClickActive = true;
        doubleClickTimeout = Date.now() + 300000; // 5åˆ†
        setTimeout(() => {
          doubleClickActive = false;
          updateUI();
          console.log('ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœçµ‚äº†');
        }, 300000);
        console.log('ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³ä½¿ç”¨');
      } else if (index === 1) { // ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹
        const reward = Math.floor(Math.random() * (1000 - 50 + 1)) + 50;
        points += reward;
        showPointPop(reward);
        console.log(`ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹ä½¿ç”¨: ${reward}ãƒã‚¤ãƒ³ãƒˆç²å¾—`);
      }
      updateUI();
    }

    // å¯¾æˆ¦ç›¸æ‰‹æ¤œç´¢
    function findOpponent() {
      if (pvpStatus !== 'å¾…æ©Ÿä¸­') return;
      pvpStatus = 'å¯¾æˆ¦ç›¸æ‰‹æ¤œç´¢ä¸­...';
      opponent = mockDatabase[Math.floor(Math.random() * mockDatabase.length)];
      while (opponent.id === user.id) {
        opponent = mockDatabase[Math.floor(Math.random() * mockDatabase.length)];
      }
      playerReady = false;
      opponentReady = false;
      clickCount = 0;
      document.getElementById('readyButton').disabled = false;
      document.getElementById('startButton').disabled = true;
      updateUI();
      console.log('å¯¾æˆ¦ç›¸æ‰‹ç™ºè¦‹:', opponent);
      setTimeout(() => {
        opponentReady = true;
        pvpStatus = 'å¯¾æˆ¦ç›¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼æº–å‚™å®Œäº†ã—ã¦ãã ã•ã„ã€‚';
        updateUI();
      }, Math.random() * 3000 + 1000);
    }

    // æº–å‚™å®Œäº†
    function readyForMatch() {
      playerReady = true;
      pvpStatus = opponentReady ? 'æº–å‚™å®Œäº†ï¼è©¦åˆé–‹å§‹ã—ã¦ãã ã•ã„ã€‚' : 'ç›¸æ‰‹ã®æº–å‚™ã‚’å¾…ã£ã¦ã„ã¾ã™...';
      document.getElementById('readyButton').disabled = true;
      if (opponentReady) document.getElementById('startButton').disabled = false;
      updateUI();
      console.log('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æº–å‚™å®Œäº†');
    }

    // è©¦åˆé–‹å§‹
    function startMatch() {
      pvpStatus = 'è©¦åˆä¸­...';
      clickCount = 0;
      matchStartTime = Date.now();
      document.getElementById('startButton').disabled = true;
      updateUI();
      console.log('PvPè©¦åˆé–‹å§‹');
      setTimeout(() => {
        const cps = clickCount / 10;
        const opponentCps = Math.random() * 10 + 5; // ãƒ¢ãƒƒã‚¯: 5ï½15 CPS
        let winner = cps > opponentCps ? user : opponent;
        pvpRank = Math.max(1, pvpRank || mockDatabase.length + 1);
        if (winner.id === user.id) {
          pvpRank = Math.max(1, pvpRank - 1);
          points += pvpRank === 1 ? 1000 : pvpRank === 2 ? 500 : pvpRank === 3 ? 200 : 100;
          items[0].count += pvpRank === 1 ? 2 : 1;
          items[1].count += pvpRank === 1 ? 3 : pvpRank === 2 ? 2 : 1;
        }
        mockDatabase.forEach(p => {
          if (p.id === user.id) p.rank = pvpRank;
          else if (p.id === opponent.id && cps > opponentCps) p.rank = Math.min(mockDatabase.length + 1, p.rank + 1);
        });
        mockDatabase.sort((a, b) => (a.rank || mockDatabase.length + 1) - (b.rank || mockDatabase.length + 1));
        localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
        pvpStatus = `è©¦åˆçµ‚äº†ï¼ã‚ãªãŸã®CPS: ${cps.toFixed(2)}, ç›¸æ‰‹ã®CPS: ${opponentCps.toFixed(2)}. å‹è€…: ${winner.username}`;
        document.getElementById('readyButton').disabled = true;
        setTimeout(() => {
          pvpStatus = 'å¾…æ©Ÿä¸­';
          opponent = null;
          playerReady = false;
          opponentReady = false;
          updateUI();
        }, 3000);
        updateUI();
        console.log('PvPè©¦åˆçµ‚äº†:', { cps, opponentCps, winner: winner.username });
      }, 10000);
    }

    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢
    function searchPlayer() {
      const query = document.getElementById('searchInput').value;
      const result = mockDatabase.find(p => p.username === query || p.id === query);
      document.getElementById('searchResult').textContent = result
        ? `ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${result.username} (${result.icon}), ãƒã‚¤ãƒ³ãƒˆ: ${result.points}, ãƒ©ãƒ³ã‚¯: ${result.rank || 'æœªå‚åŠ '}`
        : 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
      console.log('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ¤œç´¢:', query, result);
    }

    // æœˆæ¬¡ãƒªã‚»ãƒƒãƒˆ
    function checkMonthlyReset() {
      const now = new Date();
      const lastReset = new Date(localStorage.getItem('lastReset') || now);
      if (now.getMonth() !== lastReset.getMonth() || now.getFullYear() !== lastReset.getFullYear()) {
        mockDatabase.forEach(p => {
          if (p.rank === 1) p.points += 1000;
          else if (p.rank === 2) p.points += 500;
          else if (p.rank === 3) p.points += 200;
          p.rank = 0;
        });
        pvpRank = 0;
        localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
        localStorage.setItem('lastReset', now.toISOString());
        console.log('æœˆæ¬¡ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œ');
      }
    }

    // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”»é¢è¡¨ç¤º
    function showUpgrades() {
      switchScreen('upgradesScreen');
      console.log('ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç”»é¢è¡¨ç¤º');
    }

    // ã‚¢ã‚¤ãƒ†ãƒ ç”»é¢è¡¨ç¤º
    function showItems() {
      switchScreen('itemsScreen');
      console.log('ã‚¢ã‚¤ãƒ†ãƒ ç”»é¢è¡¨ç¤º');
    }

    // PvPç”»é¢è¡¨ç¤º
    function showPvp() {
      switchScreen('pvpScreen');
      console.log('PvPç”»é¢è¡¨ç¤º');
    }

    // æ¤œç´¢ç”»é¢è¡¨ç¤º
    function showSearch() {
      switchScreen('searchScreen');
      document.getElementById('searchResult').textContent = 'æœªæ¤œç´¢';
      console.log('æ¤œç´¢ç”»é¢è¡¨ç¤º');
    }

    // è¨­å®šç”»é¢è¡¨ç¤º
    function showSettings() {
      switchScreen('settingsScreen');
      document.getElementById('settingsUserId').textContent = user.id;
      document.getElementById('newUsername').value = user.username;
      document.getElementById('newIcon').value = user.icon;
      console.log('è¨­å®šç”»é¢è¡¨ç¤º');
    }

    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
    function updateProfile() {
      const newUsername = document.getElementById('newUsername').value;
      const newIcon = document.getElementById('newIcon').value;
      if (newUsername) {
        user.username = newUsername;
        user.icon = newIcon;
        mockDatabase.find(p => p.id === user.id).username = newUsername;
        mockDatabase.find(p => p.id === user.id).icon = newIcon;
        localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
        updateUI();
        backToGame();
        console.log('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°:', { username: newUsername, icon: newIcon });
      } else {
        alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
    }

    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒªã‚»ãƒƒãƒˆ
    function confirmReset() {
      if (confirm('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        points = 0;
        upgrades = [
          { level: 0, cost: 10, effect: 1 },
          { level: 0, cost: 50, effect: 0.1 },
          { level: 0, cost: 100, effect: 1.5 },
          { level: 0, cost: 200, effect: 0.2 },
          { level: 0, cost: 500, effect: 0.05 }
        ];
        items = [
          { name: 'ã‚¯ãƒªãƒƒã‚¯2å€ãƒãƒ¼ã‚·ãƒ§ãƒ³', count: 0, cost: 500 },
          { name: 'ã‚®ãƒ•ãƒˆãƒœãƒƒã‚¯ã‚¹', count: 0, cost: 200 }
        ];
        pvpRank = 0;
        mockDatabase.find(p => p.id === user.id).rank = 0;
        if (autoInterval) clearInterval(autoInterval);
        startAutoClick();
        user.points = points;
        user.upgrades = upgrades;
        user.items = items;
        user.rank = pvpRank;
        localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
        updateUI();
        console.log('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒªã‚»ãƒƒãƒˆ');
      }
    }

    // ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤
    function confirmDelete() {
      const inputId = prompt('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®å…¥åŠ›ãŒå¿…è¦ã§ã™:');
      if (inputId === user.id) {
        mockDatabase = mockDatabase.filter(p => p.id !== user.id);
        localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
        localStorage.removeItem('clickerUser');
        window.location.reload();
        console.log('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤');
      } else {
        alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ï¼');
      }
    }

    // ã‚²ãƒ¼ãƒ ã«æˆ»ã‚‹
    function backToGame() {
      switchScreen('gameScreen');
      console.log('ã‚²ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹');
    }

    // ã‚²ãƒ¼ãƒ ä¿å­˜
    function saveGame() {
      user.points = points;
      user.upgrades = upgrades;
      user.items = items;
      user.rank = pvpRank;
      mockDatabase.find(p => p.id === user.id).points = points;
      mockDatabase.find(p => p.id === user.id).rank = pvpRank;
      localStorage.setItem('clickerUser', JSON.stringify(user));
      localStorage.setItem('mockDatabase', JSON.stringify(mockDatabase));
      console.log('ã‚²ãƒ¼ãƒ ä¿å­˜:', user);
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç¢ºèª
    window.onload = () => {
      const savedUser = localStorage.getItem('clickerUser');
      if (savedUser) {
        user = JSON.parse(savedUser);
        loadGame();
      } else {
        console.log('æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãªã—');
        switchScreen('loginScreen');
      }
    };
  </script>
</body>
</html>